async function n(){const e=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT),t=[];let o;for(;o=e.nextNode();){const r=o.textContent?.trim();r&&t.push(r)}return t.join(`
`)}async function s(){if(!("ai"in globalThis)||!ai.summarizer)return"Summarizer API not available in this Chrome build.";const e=await n();try{const t=await ai.summarizer.capabilities();if(t?.available!=="readily")return`Summarizer not ready: ${t?.available}`;const o=await ai.summarizer.summarize(e);return String(o??"")}catch(t){return t?.message??String(t)}}chrome.runtime.onMessage.addListener((e,t,o)=>{if(e?.action==="summarizePage")return s().then(r=>o({summary:r})),!0;if(e?.action==="perform")return(async()=>{try{const r=await u(e.payload);o({ok:!0,log:r})}catch(r){o({ok:!1,error:r?.message??String(r)})}})(),!0});async function u(e){switch(e?.type){case"navigate":return window.location.href=e.url,`Navigating to ${e.url}`;case"wait":return await new Promise(t=>setTimeout(t,e.ms??1e3)),`Waited ${e.ms}ms`;case"click":{const t=document.querySelector(e.selector);if(!t)throw new Error(`No element for selector ${e.selector}`);return t.click(),`Clicked ${e.selector}`}case"type":{const t=document.querySelector(e.selector);if(!t)throw new Error(`No element for selector ${e.selector}`);return t.focus(),t.value=e.text,t.dispatchEvent(new Event("input",{bubbles:!0})),e.submit&&t.form?.submit(),`Typed into ${e.selector}`}case"starGithubRepo":{const{owner:t,repo:o}=e,r=`https://github.com/${t}/${o}`;location.href.startsWith(r)||(window.location.href=r,await new Promise(i=>setTimeout(i,2e3)));const a=document.querySelector('button[aria-label^="Star this repository"], button[aria-label^="Unstar this repository"], .js-social-form button[aria-label*="Star"]');if(!a)throw new Error("GitHub Star button not found");return a.click(),"Toggled star on repository"}default:throw new Error(`Unknown action: ${JSON.stringify(e)}`)}}
